<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KML Data Viewer - ·ûÉ·ûª·üÜ·ûï·üí·ûõ·ûº·ûú·ûò·û∂·ûü</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
            padding: 20px;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }
        
        .panel {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            height: fit-content;
        }
        
        .panel-header {
            background: linear-gradient(90deg, #4CAF50, #2E7D32);
            color: white;
            padding: 20px;
            font-size: 1.3em;
            font-weight: 600;
        }
        
        .panel-content {
            padding: 25px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .info-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }
        
        .info-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }
        
        .info-value {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }
        
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #2196F3, #0D47A1);
            color: white;
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.3);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #FF9800, #F57C00);
            color: white;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 152, 0, 0.3);
        }
        
        .search-container {
            margin-bottom: 20px;
        }
        
        .search-box {
            width: 100%;
            padding: 16px 20px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            transition: border-color 0.3s;
        }
        
        .search-box:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        .locations-list {
            max-height: 600px;
            overflow-y: auto;
        }
        
        .location-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            margin-bottom: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .location-card:hover {
            border-color: #4CAF50;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .location-card.selected {
            border-color: #2196F3;
            background: #e8f0fe;
        }
        
        .location-name {
            font-size: 1.2em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .location-coords {
            display: inline-block;
            background: #2c3e50;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .location-desc {
            color: #666;
            font-size: 14px;
            line-height: 1.5;
            margin-top: 10px;
        }
        
        .description-content {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
            border-left: 3px solid #4CAF50;
        }
        
        .description-content.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .toggle-desc {
            color: #2196F3;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .coordinates-display {
            background: #1a237e;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            font-family: monospace;
        }
        
        .coord-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .coord-label {
            color: #bbdefb;
        }
        
        .coord-value {
            font-weight: 600;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        .error-box {
            background: #ffebee;
            color: #c62828;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #c62828;
        }
        
        .success-box {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #2e7d32;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        footer {
            text-align: center;
            color: white;
            padding: 20px;
            margin-top: 40px;
            opacity: 0.8;
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .action-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üåç KML Data Viewer</h1>
            <div class="subtitle">·ûÉ·ûª·üÜ·ûï·üí·ûõ·ûº·ûú·ûò·û∂·ûü (Phlow Meas Commune) - Cambodia</div>
        </header>
        
        <div class="main-layout">
            <!-- Left Panel - Information & Actions -->
            <div class="panel">
                <div class="panel-header">
                    Repository Information
                </div>
                <div class="panel-content">
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">KML File</div>
                            <div class="info-value">·ûÉ·ûª·üÜ·ûï·üí·ûõ·ûº·ûú·ûò·û∂·ûü.kml</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Repository</div>
                            <div class="info-value">Search-Phlov-Meas</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Owner</div>
                            <div class="info-value">Gintra121</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Status</div>
                            <div class="info-value" id="status-indicator">Loading...</div>
                        </div>
                    </div>
                    
                    <div id="selected-location-info" style="display: none;">
                        <h3 style="margin-bottom: 15px; color: #2c3e50;">üìç Selected Location</h3>
                        <div id="location-details"></div>
                        <div id="coordinates-display" class="coordinates-display" style="display: none;">
                            <div class="coord-row">
                                <span class="coord-label">Latitude:</span>
                                <span class="coord-value" id="coord-lat"></span>
                            </div>
                            <div class="coord-row">
                                <span class="coord-label">Longitude:</span>
                                <span class="coord-value" id="coord-lng"></span>
                            </div>
                            <div class="coord-row">
                                <span class="coord-label">Altitude:</span>
                                <span class="coord-value" id="coord-alt">0</span> m
                            </div>
                        </div>
                        
                        <div class="action-buttons">
                            <button class="btn btn-secondary" onclick="openInGoogleMaps()">
                                <span>üó∫Ô∏è</span> Open in Maps
                            </button>
                            <button class="btn btn-warning" onclick="openInGoogleEarth()">
                                <span>üåç</span> Open in Earth
                            </button>
                        </div>
                    </div>
                    
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="downloadKML()">
                            <span>üì•</span> Download KML File
                        </button>
                        <button class="btn btn-secondary" onclick="viewOnGitHub()">
                            <span>üêô</span> View on GitHub
                        </button>
                        <button class="btn btn-warning" onclick="clearSelection()">
                            <span>üóëÔ∏è</span> Clear Selection
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Right Panel - Locations List -->
            <div class="panel">
                <div class="panel-header">
                    KML Locations (<span id="location-count">0</span> found)
                </div>
                <div class="panel-content">
                    <div class="search-container">
                        <input type="text" 
                               id="searchInput" 
                               class="search-box" 
                               placeholder="üîç Search locations by name or description..."
                               onkeyup="filterLocations()">
                    </div>
                    
                    <div id="locations-container" class="locations-list">
                        <div class="loading" id="loading">
                            <div class="spinner"></div>
                            <p>Loading KML data from GitHub...</p>
                            <p style="font-size: 14px; margin-top: 10px;">File: ·ûÉ·ûª·üÜ·ûï·üí·ûõ·ûº·ûú·ûò·û∂·ûü.kml</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>KML Data Viewer ‚Ä¢ Loading data directly from GitHub repository</p>
            <p style="font-size: 14px; margin-top: 10px;">Repository: <a href="https://github.com/Gintra121/Search-Phlov-Meas" style="color: white;">Gintra121/Search-Phlov-Meas</a></p>
        </footer>
    </div>

    <script>
        // Configuration
        const KML_URL = 'https://raw.githubusercontent.com/Gintra121/Search-Phlov-Meas/main/%E1%9E%83%E1%9F%86%E1%9E%9F%E1%9F%8B%E1%9E%9A%E1%9E%9B%E1%9E%8F%E1%9E%98%E1%9E%B8%E1%9E%9F%E1%9E%98%E1%9E%B6.kml';
        const GITHUB_URL = 'https://github.com/Gintra121/Search-Phlov-Meas/blob/main/%E1%9E%83%E1%9F%86%E1%9E%9F%E1%9F%8B%E1%9E%9A%E1%9E%9B%E1%9E%8F%E1%9E%98%E1%9E%B8%E1%9E%9F%E1%9E%98%E1%9E%B6.kml';
        
        // Global variables
        let allLocations = [];
        let filteredLocations = [];
        let selectedLocation = null;
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('Starting KML data loading from GitHub...');
            await loadKMLData();
        });
        
        // Load KML data from GitHub
        async function loadKMLData() {
            try {
                showStatus('Loading KML data...', 'loading');
                
                // Fetch KML file from GitHub
                const response = await fetch(KML_URL);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const kmlText = await response.text();
                console.log('KML data loaded successfully');
                
                // Parse KML data
                parseKMLData(kmlText);
                
                // Display success
                showStatus('Data loaded successfully', 'success');
                document.getElementById('loading').style.display = 'none';
                
            } catch (error) {
                console.error('Error loading KML:', error);
                showError('Failed to load KML data. Using sample data instead.');
                useSampleData();
            }
        }
        
        // Parse KML XML data
        function parseKMLData(kmlText) {
            try {
                // Parse XML
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(kmlText, 'text/xml');
                
                // Check for parsing errors
                const parserError = xmlDoc.querySelector('parsererror');
                if (parserError) {
                    throw new Error('Invalid XML format');
                }
                
                // Extract all Placemark elements
                const placemarks = xmlDoc.querySelectorAll('Placemark');
                
                allLocations = [];
                
                placemarks.forEach((placemark, index) => {
                    // Extract name
                    const nameElement = placemark.querySelector('name');
                    const name = nameElement ? nameElement.textContent.trim() : `Location ${index + 1}`;
                    
                    // Extract coordinates
                    const coordsElement = placemark.querySelector('coordinates');
                    let coordinates = null;
                    
                    if (coordsElement) {
                        const coordsText = coordsElement.textContent.trim();
                        const parts = coordsText.split(/\s*,\s*/);
                        if (parts.length >= 2) {
                            coordinates = {
                                longitude: parseFloat(parts[0]),
                                latitude: parseFloat(parts[1]),
                                altitude: parts.length >= 3 ? parseFloat(parts[2]) : 0
                            };
                        }
                    }
                    
                    // Extract description
                    const descElement = placemark.querySelector('description');
                    let description = '';
                    
                    if (descElement) {
                        // Try to extract text content from HTML description
                        const tempDiv = document.createElement('div');
                        tempDiv.innerHTML = descElement.innerHTML;
                        description = tempDiv.textContent.trim();
                    }
                    
                    // Extract additional data
                    const extendedData = {};
                    const extendedElements = placemark.querySelectorAll('ExtendedData Data');
                    extendedElements.forEach(dataElement => {
                        const name = dataElement.getAttribute('name');
                        const value = dataElement.querySelector('value')?.textContent || '';
                        if (name && value) {
                            extendedData[name] = value.trim();
                        }
                    });
                    
                    // Create location object
                    const location = {
                        id: index + 1,
                        name: name,
                        description: description,
                        coordinates: coordinates,
                        extendedData: extendedData,
                        hasCoordinates: coordinates !== null,
                        rawData: placemark.outerHTML
                    };
                    
                    allLocations.push(location);
                });
                
                console.log(`Parsed ${allLocations.length} locations from KML`);
                
                // Update UI
                filteredLocations = [...allLocations];
                renderLocations();
                updateLocationCount();
                
            } catch (error) {
                console.error('Error parsing KML:', error);
                throw error;
            }
        }
        
        // Render locations list
        function renderLocations() {
            const container = document.getElementById('locations-container');
            
            if (filteredLocations.length === 0) {
                container.innerHTML = `
                    <div class="error-box">
                        No locations found. Try adjusting your search.
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            filteredLocations.forEach(location => {
                const isSelected = selectedLocation && selectedLocation.id === location.id;
                
                // Format description preview
                let descPreview = location.description;
                if (descPreview.length > 150) {
                    descPreview = descPreview.substring(0, 150) + '...';
                }
                
                // Format coordinates if available
                let coordsHTML = '';
                if (location.hasCoordinates) {
                    const lat = location.coordinates.latitude.toFixed(6);
                    const lng = location.coordinates.longitude.toFixed(6);
                    coordsHTML = `
                        <div class="location-coords">
                            üìç ${lat}, ${lng}
                        </div>
                    `;
                }
                
                // Extended data preview
                let extendedDataHTML = '';
                const extendedKeys = Object.keys(location.extendedData);
                if (extendedKeys.length > 0) {
                    extendedDataHTML = `
                        <div style="margin-top: 10px;">
                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">Additional Data:</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 5px;">
                                ${extendedKeys.slice(0, 3).map(key => `
                                    <span style="background: #e3f2fd; color: #1565c0; padding: 3px 8px; border-radius: 4px; font-size: 12px;">
                                        ${key}: ${location.extendedData[key]}
                                    </span>
                                `).join('')}
                                ${extendedKeys.length > 3 ? `<span style="color: #666; font-size: 12px;">+${extendedKeys.length - 3} more</span>` : ''}
                            </div>
                        </div>
                    `;
                }
                
                html += `
                    <div class="location-card ${isSelected ? 'selected' : ''}" 
                         onclick="selectLocation(${location.id})"
                         data-id="${location.id}">
                        <div class="location-name">${escapeHtml(location.name)}</div>
                        ${coordsHTML}
                        
                        ${location.description ? `
                            <div class="location-desc">
                                ${escapeHtml(descPreview)}
                            </div>
                            
                            ${location.description.length > 150 ? `
                                <button class="toggle-desc" onclick="toggleDescription(${location.id}, event)">
                                    <span>üìñ</span> Show Full Description
                                </button>
                                
                                <div class="description-content" id="desc-${location.id}">
                                    ${escapeHtml(location.description)}
                                </div>
                            ` : ''}
                        ` : ''}
                        
                        ${extendedDataHTML}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Toggle description visibility
        function toggleDescription(locationId, event) {
            event.stopPropagation();
            const descElement = document.getElementById(`desc-${locationId}`);
            const button = event.currentTarget;
            
            if (descElement.classList.contains('show')) {
                descElement.classList.remove('show');
                button.innerHTML = '<span>üìñ</span> Show Full Description';
            } else {
                descElement.classList.add('show');
                button.innerHTML = '<span>üìï</span> Hide Description';
            }
        }
        
        // Select a location
        function selectLocation(locationId) {
            // Remove previous selection
            document.querySelectorAll('.location-card.selected').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Find and select new location
            selectedLocation = allLocations.find(loc => loc.id === locationId);
            
            if (selectedLocation) {
                // Highlight card
                const card = document.querySelector(`[data-id="${locationId}"]`);
                if (card) card.classList.add('selected');
                
                // Update info panel
                updateSelectedInfo();
                
                // Scroll to selection
                card.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }
        
        // Update selected location info
        function updateSelectedInfo() {
            const infoPanel = document.getElementById('selected-location-info');
            const detailsDiv = document.getElementById('location-details');
            const coordsDiv = document.getElementById('coordinates-display');
            
            if (!selectedLocation) {
                infoPanel.style.display = 'none';
                return;
            }
            
            infoPanel.style.display = 'block';
            
            // Build details HTML
            let detailsHTML = `
                <h4 style="color: #2c3e50; margin-bottom: 10px;">${escapeHtml(selectedLocation.name)}</h4>
            `;
            
            if (selectedLocation.description) {
                detailsHTML += `
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <div style="font-size: 14px; color: #666; margin-bottom: 5px;">Description:</div>
                        <div>${escapeHtml(selectedLocation.description)}</div>
                    </div>
                `;
            }
            
            // Extended data
            const extendedKeys = Object.keys(selectedLocation.extendedData);
            if (extendedKeys.length > 0) {
                detailsHTML += `
                    <div style="margin-bottom: 15px;">
                        <div style="font-size: 14px; color: #666; margin-bottom: 8px;">Additional Information:</div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;">
                            ${extendedKeys.map(key => `
                                <div style="background: #e8f0fe; padding: 10px; border-radius: 6px;">
                                    <div style="font-size: 12px; color: #1565c0;">${escapeHtml(key)}</div>
                                    <div style="font-size: 14px; font-weight: 500;">${escapeHtml(selectedLocation.extendedData[key])}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            detailsDiv.innerHTML = detailsHTML;
            
            // Update coordinates display
            if (selectedLocation.hasCoordinates) {
                document.getElementById('coord-lat').textContent = selectedLocation.coordinates.latitude.toFixed(6);
                document.getElementById('coord-lng').textContent = selectedLocation.coordinates.longitude.toFixed(6);
                document.getElementById('coord-alt').textContent = selectedLocation.coordinates.altitude;
                coordsDiv.style.display = 'block';
            } else {
                coordsDiv.style.display = 'none';
            }
        }
        
        // Filter locations based on search input
        function filterLocations() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            
            if (!searchTerm) {
                filteredLocations = [...allLocations];
            } else {
                filteredLocations = allLocations.filter(location => {
                    const searchText = (
                        location.name.toLowerCase() +
                        location.description.toLowerCase() +
                        Object.values(location.extendedData).join(' ').toLowerCase()
                    );
                    return searchText.includes(searchTerm);
                });
            }
            
            renderLocations();
            updateLocationCount();
            
            // Clear selection if filtered out
            if (selectedLocation && !filteredLocations.find(loc => loc.id === selectedLocation.id)) {
                selectedLocation = null;
                updateSelectedInfo();
            }
        }
        
        // Update location count
        function updateLocationCount() {
            document.getElementById('location-count').textContent = filteredLocations.length;
        }
        
        // Show status message
        function showStatus(message, type = 'info') {
            const statusElement = document.getElementById('status-indicator');
            statusElement.textContent = message;
            
            switch (type) {
                case 'loading':
                    statusElement.style.color = '#FF9800';
                    break;
                case 'success':
                    statusElement.style.color = '#4CAF50';
                    break;
                case 'error':
                    statusElement.style.color = '#F44336';
                    break;
                default:
                    statusElement.style.color = '#2196F3';
            }
        }
        
        // Show error message
        function showError(message) {
            const container = document.getElementById('locations-container');
            container.innerHTML = `
                <div class="error-box">
                    <h3>‚ö†Ô∏è Error Loading Data</h3>
                    <p>${message}</p>
                    <button class="btn btn-primary" onclick="loadKMLData()" style="margin-top: 10px;">
                        Try Again
                    </button>
                </div>
            `;
            document.getElementById('loading').style.display = 'none';
            showStatus('Load failed', 'error');
        }
        
        // Use sample data if loading fails
        function useSampleData() {
            allLocations = [
                {
                    id: 1,
                    name: "·ûÉ·ûª·üÜ·ûï·üí·ûõ·ûº·ûú·ûò·û∂·ûü - ·ûó·ûº·ûò·û∑·ûë·û∏·ü°",
                    description: "·ûó·ûº·ûò·û∑·ûë·û∏·ü° ·ûì·üÉ·ûÉ·ûª·üÜ·ûï·üí·ûõ·ûº·ûú·ûò·û∂·ûü ·ûü·üí·ûö·ûª·ûÄ·û¢·ûé·üí·ûä·ûº·ûÑ·ûò·û∂·ûü ·ûÅ·üÅ·ûè·üí·ûè·ûÄ·üÜ·ûñ·ûÑ·üã·ûü·üí·ûñ·û∫",
                    coordinates: { latitude: 11.556373, longitude: 104.928208, altitude: 25 },
                    extendedData: {
                        "Province": "Kampong Speu",
                        "District": "Angdoung Meas",
                        "Commune": "Phlov Meas",
                        "Village": "Village 1",
                        "Population": "2,500"
                    },
                    hasCoordinates: true
                },
                {
                    id: 2,
                    name: "·ûÉ·ûª·üÜ·ûï·üí·ûõ·ûº·ûú·ûò·û∂·ûü - ·ûü·û∂·ûõ·û∂·ûö·üÄ·ûì",
                    description: "·ûü·û∂·ûõ·û∂·ûî·ûã·ûò·ûü·û∑·ûÄ·üí·ûü·û∂·ûï·üí·ûõ·ûº·ûú·ûò·û∂·ûü ·ûÄ·ûì·üí·ûõ·üÇ·ûÑ·û¢·ûî·üã·ûö·üÜ·ûü·üÜ·ûÅ·û∂·ûì·üã·ûÄ·üí·ûì·ûª·ûÑ·ûÉ·ûª·üÜ",
                    coordinates: { latitude: 11.558921, longitude: 104.930415, altitude: 28 },
                    extendedData: {
                        "Type": "School",
                        "Students": "850",
                        "Teachers": "25",
                        "Established": "1995"
                    },
                    hasCoordinates: true
                },
                {
                    id: 3,
                    name: "·ûú·ûè·üí·ûè·ûï·üí·ûõ·ûº·ûú·ûò·û∂·ûü",
                    description: "·ûú·ûè·üí·ûè·û¢·û∂·ûö·û∂·ûò·ûä·üÇ·ûõ·ûá·û∂·ûÖ·üÜ·ûé·ûª·ûÖ·ûï·üí·ûõ·ûº·ûú·ûú·ûî·üí·ûî·ûí·ûò·üå·ûì·û∑·ûÑ·ûü·û∂·ûü·ûì·û∂·ûÄ·üí·ûì·ûª·ûÑ·ûè·üÜ·ûî·ûì·üã",
                    coordinates: { latitude: 11.560123, longitude: 104.926734, altitude: 30 },
                    extendedData: {
                        "Type": "Temple",
                        "Religion": "Buddhism",
                        "Monks": "12",
                        "Festivals": "Khmer New Year, Pchum Ben"
                    },
                    hasCoordinates: true
                }
            ];
            
            filteredLocations = [...allLocations];
            renderLocations();
            updateLocationCount();
            document.getElementById('loading').style.display = 'none';
            showStatus('Using sample data', 'warning');
        }
        
        // Action Functions
        function downloadKML() {
            // Create download link
            const link = document.createElement('a');
            link.href = KML_URL;
            link.download = '·ûÉ·ûª·üÜ·ûï·üí·ûõ·ûº·ûú·ûò·û∂·ûü.kml';
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Show confirmation
            alert('KML file download started. If it doesn\'t start automatically, you can right-click the link and choose "Save link as..."');
        }
        
        function viewOnGitHub() {
            window.open(GITHUB_URL, '_blank');
        }
        
        function openInGoogleMaps() {
            if (!selectedLocation || !selectedLocation.hasCoordinates) {
                alert('Please select a location with coordinates first');
                return;
            }
            
            const lat = selectedLocation.coordinates.latitude;
            const lng = selectedLocation.coordinates.longitude;
            const mapsUrl = `https://www.google.com/maps?q=${lat},${lng}&z=15`;
            window.open(mapsUrl, '_blank');
        }
        
        function openInGoogleEarth() {
            if (!selectedLocation || !selectedLocation.hasCoordinates) {
                alert('Please select a location with coordinates first');
                return;
            }
            
            const lat = selectedLocation.coordinates.latitude;
            const lng = selectedLocation.coordinates.longitude;
            const earthUrl = `https://earth.google.com/web/@${lat},${lng},${selectedLocation.coordinates.altitude + 1000}a,1000d,35y,0h,0t,0r`;
            window.open(earthUrl, '_blank');
        }
        
        function clearSelection() {
            selectedLocation = null;
            updateSelectedInfo();
            
            // Remove selection from cards
            document.querySelectorAll('.location-card.selected').forEach(card => {
                card.classList.remove('selected');
            });
        }
        
        // Utility function to escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
